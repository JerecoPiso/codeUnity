<!DOCTYPE html>
<html>
<head>
	 {% load static %}
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title>{{request.session.title}}</title>
	<link rel="stylesheet" type="text/css" href="{% static 'assets/css/materialize.css' %}">
	

	<link rel="stylesheet" type="text/css" href="{% static 'assets/css/ls.css' %}">
</head>
<body>

	{% block login_signup_verify %}
    

    {% endblock %}
<script type="text/javascript" src="{% static 'assets/js/jquery.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/js/axios.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/js/vue.js' %}"></script>
 <script type="text/javascript" src="{% static 'assets/js/login_signup_verify.js' %}"></script> 
<script type="text/javascript">
	var signup = new Vue({
	delimiters: ['[', ']'],
	el: "#signup",
	data:{
		signupInfo: {username: '',email: '', password: '', password2: ''},
		error: '',
		success: '',
		status: 'Signup'
	},
	mounted: function(){
		// alert($('input[name=csrfmiddlewaretoken]').val())

	},
	methods: {
		register: function(){

			if((signup.signupInfo.email && signup.signupInfo.password && signup.signupInfo.password2) != ""){
				if(signup.signupInfo.password.length < 7){
					signup.error = "Password must contain at least 8 characters!";
				}else if(signup.signupInfo.password != signup.signupInfo.password2){
					signup.error = "Password didn't matched!";
				}else{

					 var data = signup.toFormData(signup.signupInfo);
					axios.post("register", data, {headers: {'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value}}).then(function(response){
						
							if(response.data != "Success"){
								signup.error = response.data;
								setTimeout(function(){
									signup.error = "";
												
								}, 2000)
							}else{
								$("#btn-signup").css({'opacity': '0.6'})
								signup.status = 'Redirecting...'
								setTimeout(function(){
									window.location.href = "verify"
								}, 2000)
								
							}
						
					})
				}	
				
			}else{
			 		signup.error =	"All fields must be filled up!";
			}
			
			

		},

		 toFormData: function(obj){
            var form_data = new FormData();
            for(var key in obj){
                form_data.append(key, obj[key]);
            }
            return form_data;
      },
	}
})
	var verify = new Vue({
		el: "#verify",
		data:{
			verifyInfo: {code: ''}
		},
		methods:{
			verify: function(){
				let data = verify.toFormData(verify.verifyInfo)
				axios.post('verified', data, {headers: {'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value}}).then(function(resp){
					if(resp.data == "Correct"){
						window.location.href = "/codeunity/user"
					}else{
						alert(resp.data)
					}
				})
			},
			 toFormData: function(obj){
	            var form_data = new FormData();
	            for(var key in obj){
	                form_data.append(key, obj[key]);
	            }
	            return form_data;
      		},
		}
	})
</script>
</body>
</html>