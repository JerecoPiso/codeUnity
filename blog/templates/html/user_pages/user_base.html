<!DOCTYPE html>
<html>
<head>
	{% load static %}
	<title>{{request.session.title}}</title>
	<link rel="stylesheet" type="text/css" href="{% static 'assets/css/materialize.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'assets/css/usexxxxxxxxx.css' %}">
	{% if request.session.title == 'Home' %}
	<link rel="stylesheet" type="text/css" href="{% static 'assets/css/chart.css' %}">
	{% endif %}
	{% if request.session.title == 'Projects' %}
	<link rel="stylesheet" type="text/css" href="{% static 'assets/css/users/pppp.css' %}">
	{% endif %}
	{% if request.session.title == 'Questions' %}
	<link rel="stylesheet" type="text/css" href="{% static 'assets/css/users/questionsedd.css' %}">
	{% endif %}
	{% if request.session.title == 'Settings' %}
	<link rel="stylesheet" type="text/css" href="{% static 'assets/css/users/settingsxxxx.css' %}">
	{% endif %}
	<link rel="stylesheet" type="text/css" href="{% static 'assets/css/users/project_files.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'assets/fontawesome-free/css/all.min.css' %}"/>  
</head>
<body>

	{% block user_page %}



	{% endblock %}
	
<script src="{% static 'assets/js/jquery.js' %}" type="text/javascript"></script>
<script src="{% static 'assets/js/chart.js' %}" type="text/javascript"></script>
<script type="text/javascript" src="{% static 'assets/js/userrrrrsssed.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/js/myCharts.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/js/axios.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/js/vue.js' %}"></script>
 <script src="{% static 'assets/js/niceedit.js' %}" type="text/javascript"></script>
<script type="text/javascript">bkLib.onDomLoaded(nicEditors.allTextAreas);</script> 
<script type="text/javascript">
$(document).ready(function(){

	$('#show').click(function(){
		$('.flex-item1').show().css({'width': '35%'})
	})
	$('#bars').click(function(){
		$('.flex-item1').hide()
	})
	$("#uploadErr").click(function(){
		$(".uploadErr").fadeOut()
	})
})
	var projects = new Vue({
		delimiters: ['[', ']'],
		el: "#projects",
		data:{
			project: [],
			url: "project_files/",
			id: '',
			count: '',
			modalDel: false
		},
		mounted: function(){
			this.getProjects();

		},
		methods:{
			getProjects: function(){
				
				axios.get("getProjects").then(function(response){
					projects.project = response.data
					projects.count = response.data.length
				})
			},
			deleteProject: function(){
				
					let data = new FormData()
					data.append("id", projects.id)
				
					axios.post("deleteProject", data, {headers: {'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value}} ).then(function(response){
						alert(response.data)
						projects.modalDel = false
						projects.getProjects()
						
					})

			}
		}
	})
	var changeDp = new Vue({
		el: "#user-dp",
		data:{
			changeDpModal: false,
			photo: '',
			mydp: null,
			src: '/media/'
		},
		mounted: function(){
			this.getUser()
		},
		methods:{
			dp: function(){
				changeDp.photo  = this.$refs.photo.files[0]
			},
			changeDp: function(){
				let data = new FormData()
				data.append("photo", changeDp.photo)
				axios.post('changeDp', data,{headers: {'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value}} ).then(function(response){
					// projects.getProjects()
				 	alert(response.data)
					 changeDp.getUser()
					 sideNav.getUser()
				
				 })
			},
			getUser: function(){
				 axios.get("getUser").then(function(response){
					 changeDp.mydp = response.data[0].photo
				 })
			}
		}
	})
	var sideNav = new Vue({
		el: ".sideNav",
		data:{
	
			mydp: null,
			src: '/media/'
		},
		mounted: function(){
			this.getUser()
		},
		methods:{
	
			getUser: function(){
				 axios.get("getUser").then(function(response){
					sideNav.mydp = response.data[0].photo
				 })
			}
		}
	})
	var settings = new Vue({
		el: "#security-info",
		data:{
			editEmailDisable: true,
			editPassDisable: true,
			editHintDisable: true,
			email_save: false,
			password_save: false,
			hint_save: false,
			disabled: false,
			changePassModal: false
		},
		methods:{
			editEmail: function(){
				if(settings.email_save){
					// edit code
				}else{
					settings.email_save = true
				}
			},
			editPassword: function(){
				if(settings.password_save){
					// edit code
					settings.changePassModal = true
				}else{
					settings.password_save = true
				}
			},
			editHint: function(){
				if(settings.hint_save){
					// edit code
				}else{
					settings.hint_save = true
				}
			},
			changePassword: function(){
				alert("hehe")
			}
		}
	})
	var questions = new Vue({
		delimiters: ['[', ']'],
		el: "#my-questions",
		data: {
			questionInfo: {language: '', id: '', question: '', category: ''},
			languages: [],
			myquestions: [],
			question_cat: [],
			total_ques: ''
		},
		mounted: function(){
			this.getLanguages()
			this.getQuestionCat()
			this.getQuestions()
		},
		methods:{
			askQuestion: function(){
				let data = new FormData()
				// var ques = new nicEditors.findEditor('question');
				// ques.getContent() != "<br>" && 
				var code = new nicEditors.findEditor('code');
				// if(code.getContent() != "<br>"){
					// data.append('question', ques.getContent())
					data.append('question', questions.questionInfo.question)
					data.append('code', code.getContent())
					data.append('language', questions.questionInfo.language)
					data.append('category', questions.questionInfo.category)
					axios.post("askQuestion", data, {headers: {'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value}} ).then(function(response){
						alert(response.data)
						questions.getQuestions()
					})
				// }else{
				// 	alert("All fields must be filled up!")
				// }
				
			},
			deleteQuestion: function(){
				if (confirm("Are you sure you want to delete this data?") == true) {
					let data = new FormData()
					data.append("id", questions.questionInfo.id)
					axios.post("deleteQuestion", data, {headers: {'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value}} ).then(function(response){
						alert(response.data)
						questions.getQuestions()
						
					})

				}
		
			},
			getLanguages: function(){
				axios.get("/dashboard/getLanguages").then(function(response){
					if(response.data == "Failed"){
					alert("Unable to retrieve Languages!")
				}else{
				
					questions.languages = response.data
				}
			  })
			},
			getQuestionCat: function(){
				axios.get("/dashboard/getCategory").then(function(response){
					if(response.data == "Failed"){
					alert("Unable to retrieve Question Category!")
				}else{
					questions.question_cat = response.data
				}
			  })
			},
			getQuestions: function(){
				axios.get("getQuestions").then(function(response){
						
				if(response.data == "Failed"){
					alert("Unable to retrieve Languages!")
				}else{
				
					questions.myquestions = response.data
					questions.total_ques = response.data.length
				}
				
			  })
			}
		}
	})
	var hehe = new Vue({
		delimiters: ['[', ']'],
		el: ".folders-files",
		data:{
			path: '',
			filename: '',
			code: ''
		},
		methods: {
			getFile: function(){
				// document.querySelector('[name=csrfmiddlewaretoken]').value
				
				let fd = new FormData();
				 
				 	fd.append('path', hehe.path)
				 	fd.append('fname', hehe.filename)
		

				 axios.post('../readFile', fd,{headers: {'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value}} ).then(function(response){

				 	 if(response.data != ""){
				 	 	hehe.code = response.data
				 	 }
				 	
				 })
			}
		}
	})
	var folderUpload = new Vue({
		el: "#files",
		delimiters: ['[', ']'],
		data:{
			folder: '',
			about: '',
			language: '',
			languages: [],
			appPhoto: '',
			fileLimit: false,
			modalErr: false
		},
		mounted: function(){
			this.getLanguages()

		},
		methods:{
			getLanguages: function(){
				axios.get("/dashboard/getLanguages").then(function(response){
					if(response.data == "Failed"){
					alert("Unable to retrieve Languages!")
				}else{
				
					folderUpload.languages = response.data
				}
			  })
			},
			handleFileUpload: function(){
				folderUpload.folder = this.$refs.file.files
				var max_size = 0
				for (i = 0; i < folderUpload.folder.length; i++) {
					max_size = folderUpload.folder[i].size + max_size
					
				}
				if(max_size > 10457600){
					folderUpload.fileLimit = true
					folderUpload.modalErr = true
				}else{
					folderUpload.fileLimit = false
				}
			
				
			},
			photo: function(){
				folderUpload.appPhoto  = this.$refs.photo.files[0]
			},
			file: function(){
				if(folderUpload.fileLimit != true){

					var about = new nicEditors.findEditor('about');
					var pos = folderUpload.folder[0]['webkitRelativePath'].indexOf("/");
					let fd = new FormData();
					for(var i = 0; i < folderUpload.folder.length; i++){
						fd.append('files', folderUpload.folder[i])
						fd.append('paths', folderUpload.folder[i]['webkitRelativePath'])

					}
					fd.append("project_name", folderUpload.folder[0]['webkitRelativePath'].slice(0, pos))
					fd.append('about', about.getContent())
					fd.append("language", folderUpload.language)
					fd.append("photo", folderUpload.appPhoto)
					//  alert(folderUpload.language)
					axios.post('uploadProject', fd,{headers: {'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value}} ).then(function(response){
						projects.getProjects()
						alert(response.data)
					
					})


				}else{
					folderUpload.modalErr = true
				}
				
			
			}

		}
	})
	// function back(){
	// 	window.history.back()
	// }
	// function home(){
	// 	window.location.href = "/codeunity/user/"
	// }
</script>
</body>
</html>